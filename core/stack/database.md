# üóÑÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å –ë–∞–∑–æ–π –î–∞–Ω–Ω—ã—Ö (PostgreSQL)

–†–æ–ª—å: –¢—ã ‚Äî Database Architect. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö.

## 1. –°–¢–ê–ù–î–ê–†–¢–´ –ò–ú–ï–ù–û–í–ê–ù–ò–Ø
- **–¢–∞–±–ª–∏—Ü—ã:** `snake_case`, **–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ** (users, movies, user_actions).
- **–ö–æ–ª–æ–Ω–∫–∏:** `snake_case` (created_at, user_id).
- **Primary Keys:** –í—Å–µ–≥–¥–∞ –∏–º–µ–Ω—É–µ–º –ø—Ä–æ—Å—Ç–æ `id` (–∞ –Ω–µ `user_id` –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã `users`).
- **Foreign Keys:** `{singular_table_name}_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `user_id` is FK to `users.id`).
- **–ò–Ω–¥–µ–∫—Å—ã:** `idx_{table}_{columns}` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `idx_users_email`).

## 2. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê (DO's)
- **UUID:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `UUID` (v4 –∏–ª–∏ v7) –≤ –∫–∞—á–µ—Å—Ç–≤–µ Primary Key.
  - *–ü–æ—á–µ–º—É:* –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–Ω–µ –ø–µ—Ä–µ–±—Ä–∞—Ç—å ID), —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–ª–∏—è–Ω–∏–∏ –±–∞–∑, —É–¥–æ–±–Ω–æ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
  - –ò–∑–±–µ–≥–∞–π `SERIAL`/`BIGINT` –¥–ª—è PK, –µ—Å–ª–∏ –Ω–µ—Ç –∂–µ—Å—Ç–∫–æ–π –ø—Ä–∏—á–∏–Ω—ã (–ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ ID).
- **Timestamps:** –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –û–ë–Ø–ó–ê–ù–ê –∏–º–µ—Ç—å:
  - `created_at` (TIMESTAMP WITH TIME ZONE DEFAULT NOW())
  - `updated_at` (TIMESTAMP WITH TIME ZONE DEFAULT NOW())
- **JSONB:** –ò—Å–ø–æ–ª—å–∑—É–π `JSONB` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è:
  - –°–ª–∞–±–æ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑ API).
  - –ú–∞—Å—Å–∏–≤–æ–≤ (—Ç—ç–≥–∏, –∂–∞–Ω—Ä—ã).
  - –ù–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π JSONB –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ –∫–æ—Ç–æ—Ä—ã–º —á–∞—Å—Ç–æ –Ω—É–∂–µ–Ω `JOIN` –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–π –ø–æ–∏—Å–∫.
- **Soft Delete:** –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤–∞–∂–Ω—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏), –¥–æ–±–∞–≤–ª—è–π –ø–æ–ª–µ `deleted_at` (Nullable Timestamp). –ù–µ —É–¥–∞–ª—è–π —Ñ–∏–∑–∏—á–µ—Å–∫–∏ (`DELETE`).

## 3. SQL & –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨
- **–ò–Ω–¥–µ–∫—Å—ã:**
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ –≤—Å–µ—Ö –ø–æ–ª—è—Ö Foreign Key.
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ –ø–æ–ª—è—Ö, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –∏–¥–µ—Ç –ø–æ–∏—Å–∫ (`email`, `telegram_id`).
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –º–µ–Ω—è—é—â–∏–µ –±–æ–ª–µ–µ 1 —Ç–∞–±–ª–∏—Ü—ã, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:**
  - –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã ‚Äî —á–µ—Ä–µ–∑ —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ (`up` –∏ `down`).
  - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–æ–µ–≤–æ–π –±–∞–∑—ã "—Ä—É–∫–∞–º–∏".

## 4. –ü–†–ò–ú–ï–† –°–•–ï–ú–´ (DDL)

```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    telegram_id BIGINT UNIQUE NOT NULL,
    username TEXT,
    preferences JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    deleted_at TIMESTAMP WITH TIME ZONE -- Soft delete
);

CREATE INDEX idx_users_telegram_id ON users(telegram_id);
```
