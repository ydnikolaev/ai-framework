# ğŸ¤– Project Makefile
# Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ AI-Framework â€” https://github.com/ydnikolaev/ai-framework

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¨ Colors & Formatting
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RESET   := \033[0m
BOLD    := \033[1m
DIM     := \033[2m
RED     := \033[31m
GREEN   := \033[32m
YELLOW  := \033[33m
BLUE    := \033[34m
MAGENTA := \033[35m
CYAN    := \033[36m

define log_info
	@printf "$(CYAN)$(BOLD)â†’$(RESET) $(1)\n"
endef

define log_success
	@printf "$(GREEN)$(BOLD)âœ“$(RESET) $(1)\n"
endef

define log_warning
	@printf "$(YELLOW)$(BOLD)âš $(RESET) $(1)\n"
endef

define log_error
	@printf "$(RED)$(BOLD)âœ—$(RESET) $(1)\n"
endef

define log_header
	@printf "\n$(MAGENTA)$(BOLD)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(RESET)\n"
	@printf "$(MAGENTA)$(BOLD)  $(1)$(RESET)\n"
	@printf "$(MAGENTA)$(BOLD)â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(RESET)\n\n"
endef

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“¦ Load Environment
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ifneq (,$(wildcard ./.env))
    include .env
    export
endif

.PHONY: dev api frontend bot test lint deploy logs clean help tunnel
.DEFAULT_GOAL := help

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ Development
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

dev: ## Start dev environment (Docker Compose)
	$(call log_header,ğŸš€ Starting Dev Environment)
	@docker compose up -d
	$(call log_success,Dev environment started!)
	@printf "$(DIM)   Frontend: http://localhost:3000$(RESET)\n"
	@printf "$(DIM)   API:      http://localhost:8080$(RESET)\n"

api: ## Start backend API
	$(call log_header,âš¡ Starting API Server)
	$(call log_info,API starting on :8080...)
	@cd backend && go run ./cmd/api

frontend: ## Start frontend (Nuxt dev)
	$(call log_header,ğŸ¨ Starting Frontend)
	$(call log_info,Nuxt dev server starting...)
	@printf "$(DIM)   Local:   http://localhost:3000$(RESET)\n"
	@printf "$(DIM)   Network: http://0.0.0.0:3000$(RESET)\n\n"
	@cd frontend && npm run dev -- --host

bot: ## Start Telegram bot
	$(call log_header,ğŸ¤– Starting Telegram Bot)
	$(call log_info,Bot is starting...)
	@cd backend && go run ./cmd/bot

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª Testing
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

test: test-backend test-frontend ## Run all tests
	$(call log_success,All tests passed!)

test-backend: ## Run backend tests
	$(call log_header,ğŸ§ª Backend Tests)
	@cd backend && go test -v ./...

test-frontend: ## Run frontend tests
	$(call log_header,ğŸ§ª Frontend Tests)
	@cd frontend && npm run test 2>/dev/null || echo "No frontend tests configured"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ” Quality
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

lint: lint-backend lint-frontend ## Run all linters
	$(call log_success,Linting complete!)

lint-backend: ## Lint Go code
	$(call log_header,ğŸ” Go Linting)
	@cd backend && golangci-lint run 2>/dev/null || echo "golangci-lint not installed"

lint-frontend: ## Lint Vue/TS code
	$(call log_header,ğŸ” Frontend Linting)
	@cd frontend && npm run lint 2>/dev/null || echo "No lint script"

typecheck: ## TypeScript type check
	$(call log_header,ğŸ“ TypeScript Check)
	@cd frontend && npm run typecheck 2>/dev/null || npx nuxi typecheck

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ—„ï¸ Database
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

db: ## Start database containers
	$(call log_header,ğŸ³ Starting Database)
	@docker compose up -d
	$(call log_success,Database is running!)
	@printf "$(DIM)   PostgreSQL: localhost:5432$(RESET)\n"
	@printf "$(DIM)   Redis:      localhost:6379$(RESET)\n"

db-reset: ## âš ï¸ WIPE all data and restart DBs
	$(call log_header,ğŸ—‘ï¸  Resetting Database)
	$(call log_warning,This will DELETE all data!)
	@docker compose down -v
	@docker compose up -d
	$(call log_info,Waiting for Database to initialize...)
	@sleep 5
	$(call log_success,Database reset complete!)

migrate-up: ## Apply migrations
	$(call log_header,ğŸ”„ Running Migrations)
	@cd backend && go run ./cmd/migrate up
	$(call log_success,Migrations applied!)

migrate-down: ## Rollback last migration
	$(call log_header,ğŸ”„ Rolling Back Migration)
	$(call log_warning,Rolling back last migration...)
	@cd backend && go run ./cmd/migrate down

migrate-create: ## Create new migration (NAME=xxx)
	$(call log_header,ğŸ“ Creating Migration)
	@cd backend && go run ./cmd/migrate create $(NAME)
	$(call log_success,Migration created!)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ³ Docker
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

build: ## Build Docker images
	$(call log_header,ğŸ³ Building Docker Images)
	@docker compose build
	$(call log_success,Build complete!)

rebuild: ## Rebuild from scratch (no cache)
	$(call log_header,ğŸ³ Rebuilding Docker Images)
	$(call log_warning,Building without cache...)
	@docker compose build --no-cache
	$(call log_success,Rebuild complete!)

down: ## Stop all containers
	$(call log_header,ğŸ›‘ Stopping Containers)
	@docker compose down
	$(call log_success,All containers stopped!)

logs: ## Show Docker logs
	$(call log_header,ğŸ“‹ Docker Logs)
	@docker compose logs -f --tail 50

logs-api: ## Show API logs only
	@docker compose logs -f api

logs-bot: ## Show bot logs only
	@docker compose logs -f bot

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŒ Dev Tunnel
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

tunnel: ## Open SSH tunnel for remote testing
	$(call log_header,ğŸŒ Dev Tunnel)
	$(call log_info,Opening SSH tunnel...)
	@printf "$(CYAN)   Local:$(RESET)  localhost:3000\n"
	@printf "$(CYAN)   Remote:$(RESET) https://$(TUNNEL_HOST)\n\n"
	$(call log_warning,Press Ctrl+C to close tunnel)
	@printf "$(DIM)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€$(RESET)\n"
	@ssh -R $(TUNNEL_PORT):localhost:3000 $(SSH_USER)@$(SSH_HOST) -N

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ Production
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

deploy: ## Deploy to production (git push)
	$(call log_header,ğŸš€ Deploying to Production)
	$(call log_warning,Pushing to main branch...)
	@git push origin main
	$(call log_success,Deployed! Check GitHub Actions for status.)

ssh: ## SSH to production server
	$(call log_header,ğŸ” SSH to Production)
	@ssh $(SSH_USER)@$(SSH_HOST)

prod-logs: ## Show production logs
	$(call log_header,ğŸ“‹ Production Logs)
	@ssh $(SSH_USER)@$(SSH_HOST) "cd $(PROJECT_DIR) && docker compose logs -f --tail 100"

prod-restart: ## Restart production containers
	$(call log_header,ğŸ”„ Restarting Production)
	$(call log_warning,Restarting containers on production...)
	@ssh $(SSH_USER)@$(SSH_HOST) "cd $(PROJECT_DIR) && docker compose restart"
	$(call log_success,Production restarted!)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§¹ Cleanup
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

clean: ## Clean temporary files
	$(call log_header,ğŸ§¹ Cleaning Up)
	$(call log_info,Removing build artifacts...)
	@rm -rf frontend/.nuxt frontend/.output frontend/node_modules/.vite
	$(call log_info,Pruning Docker...)
	@docker system prune -f
	$(call log_success,Cleanup complete!)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“š Help
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

help: ## Show this help
	@printf "\n$(BOLD)$(MAGENTA)ğŸ¤– Project Name$(RESET) $(DIM)â€” Available Commands$(RESET)\n\n"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@printf "\n$(DIM)Usage: make <command>$(RESET)\n\n"
